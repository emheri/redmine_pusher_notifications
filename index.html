<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Redmine Pusher Notifications by jbox-web</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Redmine Pusher Notifications</h1>
      <h2 class="project-tagline">A Redmine plugin which makes notifying your Redmine instance easy ;)</h2>
      <a href="https://github.com/jbox-web/redmine_pusher_notifications" class="btn">View on GitHub</a>
      <a href="https://github.com/jbox-web/redmine_pusher_notifications/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/jbox-web/redmine_pusher_notifications/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h2>
<a id="-a-redmine-plugin-which-makes-notifying-your-redmine-instance-easy-" class="anchor" href="#-a-redmine-plugin-which-makes-notifying-your-redmine-instance-easy-" aria-hidden="true"><span class="octicon octicon-link"></span></a><img src="https://raw.github.com/jbox-web/redmine_pusher_notifications/gh-pages/images/pusher_logo.png" alt="logo"> A Redmine plugin which makes notifying your Redmine instance easy ;)</h2>

<p><a href="https://github.com/jbox-web/redmine_pusher_notifications/blob/devel/LICENSE"><img src="https://img.shields.io/github/license/jbox-web/redmine_pusher_notifications.svg" alt="GitHub license"></a>
<a href="https://github.com/jbox-web/redmine_pusher_notifications/releases/latest"><img src="https://img.shields.io/github/release/jbox-web/redmine_pusher_notifications.svg" alt="GitHub release"></a>
<a href="https://codeclimate.com/github/jbox-web/redmine_pusher_notifications"><img src="https://codeclimate.com/github/jbox-web/redmine_pusher_notifications.png" alt="Code Climate"></a>
<a href="https://gemnasium.com/jbox-web/redmine_pusher_notifications"><img src="https://gemnasium.com/jbox-web/redmine_pusher_notifications.svg" alt="Dependency Status"></a></p>

<p>This plugin is designed to integrate the <a href="http://pusher.com">Pusher Notification System</a> in Redmine to display nice notifications in Growl style.</p>

<p>It aims to serve as a central point to store Pusher configuration.</p>

<p>It relies on the  <a href="https://github.com/jbox-web/acts_as_notifiable_redmine">acts_as_notifiable_redmine</a> gem so plugins developpers can access to the DSL provided to register their own channels and events (see the doc below).</p>

<p>The <a href="https://github.com/jbox-web/acts_as_notifiable_redmine">acts_as_notifiable_redmine</a> also provides a method to send <strong>asynchronous</strong> notifications via Pusher.</p>

<p>It also relies on <a href="https://github.com/RobinBrouwer/gritter">gritter</a> gem to display notifications so plugins developpers also have access to its functionalities in their controllers like <a href="https://github.com/RobinBrouwer/gritter#gflash"><code>gflash</code></a> <strong>synchronous</strong> notifications ;).</p>

<p>You can take a look to the <a href="https://github.com/jbox-web/redmine_pusher_notifications/blob/devel/app/controllers/pusher_controller.rb"><code>pusher</code></a> controller which implements the both methods.</p>

<p><img src="https://raw.github.com/jbox-web/redmine_pusher_notifications/gh-pages/images/screenshot.png" alt="screenshot"></p>

<h2>
<a id="requirements" class="anchor" href="#requirements" aria-hidden="true"><span class="octicon octicon-link"></span></a>Requirements</h2>

<ul>
<li>Ruby 1.9.x or 2.0.x</li>
<li>a working <a href="http://www.redmine.org/">Redmine</a> installation</li>
<li>a free account on <a href="http://pusher.com">Pusher</a>
</li>
<li>
<a href="https://github.com/jbox-web/acts_as_notifiable_redmine">acts_as_notifiable_redmine</a> gem</li>
<li>
<a href="https://github.com/RobinBrouwer/gritter">gritter</a> gem</li>
</ul>

<h2>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installation</h2>

<div class="highlight highlight-sh"><pre><span class="pl-c">## Before install the plugin, stop Redmine!</span>

root$ su - redmine
redmine$ <span class="pl-c1">cd</span> REDMINE_ROOT/plugins
redmine$ git clone https://github.com/jbox-web/redmine_bootstrap_kit.git
redmine$ git clone https://github.com/jbox-web/redmine_pusher_notifications.git
redmine$ <span class="pl-c1">cd</span> redmine_pusher_notifications/
redmine$ git checkout v1.0.2
redmine$ <span class="pl-c1">cd</span> REDMINE_ROOT
redmine$ bundle install

<span class="pl-c">## After install the plugin, start Redmine!</span></pre></div>

<h2>
<a id="configuration" class="anchor" href="#configuration" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configuration</h2>

<p>Go to the plugin settings page within Redmine interface to configure your Pusher account informations. That's all!</p>

<h2>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Usage</h2>

<p>If you want to integrate Pusher async notifications in your plugin, or just Gitter with <code>gflash</code> you may need to register your own channels and events in your <code>init.rb</code> file : each channel can have many events. It may also have an optional <code>target</code> parameter which can be a string or a Proc.</p>

<div class="highlight highlight-ruby"><pre><span class="pl-c">## This must be OUTSIDE of the Redmine::Plugin.register block</span>

<span class="pl-c1">ActsAsNotifiableRedmine</span>::<span class="pl-c1">Notifications</span>.register_channel <span class="pl-c1">:channel_test</span> <span class="pl-k">do</span>
  target <span class="pl-c1">Proc</span>.<span class="pl-k">new</span> { <span class="pl-c1">User</span>.current.login }
  event  <span class="pl-c1">:event1</span>, <span class="pl-c1">:sticky</span> =&gt; <span class="pl-c1">true</span>
  event  <span class="pl-c1">:event2</span>, <span class="pl-c1">:sticky</span> =&gt; <span class="pl-c1">false</span>
  event  <span class="pl-c1">:event3</span>
<span class="pl-k">end</span>

<span class="pl-c1">ActsAsNotifiableRedmine</span>::<span class="pl-c1">Notifications</span>.register_channel <span class="pl-c1">:broadcast</span> <span class="pl-k">do</span>
  target <span class="pl-s"><span class="pl-pds">'</span>broadcast<span class="pl-pds">'</span></span>
  event  <span class="pl-c1">:event1</span>, <span class="pl-c1">:sticky</span> =&gt; <span class="pl-c1">true</span>
  event  <span class="pl-c1">:event2</span>, <span class="pl-c1">:sticky</span> =&gt; <span class="pl-c1">false</span>
  event  <span class="pl-c1">:event3</span>
<span class="pl-k">end</span></pre></div>

<p>Then to send notifications you have 2 options :</p>

<ul>
<li>
<strong>asynchronous</strong> notifications via Pusher</li>
<li>
<strong>synchronous</strong> notifications sent by the controller</li>
</ul>

<p>For <strong>asynchronous</strong> notifications :</p>

<div class="highlight highlight-ruby"><pre><span class="pl-c1">ActsAsNotifiableRedmine</span>::<span class="pl-c1">Notifications</span>.send_notification([channel.token], event.name, {<span class="pl-c1">:title</span> =&gt; <span class="pl-s"><span class="pl-pds">'</span>Hello!<span class="pl-pds">'</span></span>, <span class="pl-c1">:message</span> =&gt; <span class="pl-s"><span class="pl-pds">'</span>This is a test message !<span class="pl-pds">'</span></span>})</pre></div>

<p><strong>Note :</strong> The logic to determine wether or not to send a notification is let to the developer. You can easily do this with callbacks :</p>

<div class="highlight highlight-ruby"><pre><span class="pl-k">class</span> <span class="pl-en">Comment<span class="pl-e"> &lt; ActiveRecord::Base</span></span>
  has_many <span class="pl-c1">:watchers</span>
  after_create <span class="pl-c1">:send_notification</span>

  <span class="pl-k">private</span>

    <span class="pl-k">def</span> <span class="pl-en">send_notification</span>
      channels <span class="pl-k">=</span> []
      watchers.each <span class="pl-k">do </span>|<span class="pl-smi">watcher</span>|
        token <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>&lt;channel_name&gt;-<span class="pl-pds">'</span></span> <span class="pl-k">+</span> watcher.login
        channels.push(token)
      <span class="pl-k">end</span>
      <span class="pl-c1">ActsAsNotifiableRedmine</span>::<span class="pl-c1">Notifications</span>.send_notification(channels, <span class="pl-k">&lt;</span>event_name<span class="pl-k">&gt;</span>, {<span class="pl-c1">:title</span> =&gt; <span class="pl-s"><span class="pl-pds">'</span>Hello!<span class="pl-pds">'</span></span>, <span class="pl-c1">:message</span> =&gt; <span class="pl-s"><span class="pl-pds">'</span>This is a test message !<span class="pl-pds">'</span></span>})
    <span class="pl-k">end</span>
<span class="pl-k">end</span></pre></div>

<p>For <strong>synchronous</strong> notifications :</p>

<p>In a controller :</p>

<div class="highlight highlight-ruby"><pre><span class="pl-k">def</span> <span class="pl-en">test</span>
  data <span class="pl-k">=</span> {}
  data[<span class="pl-c1">:message</span>] <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>Hello!<span class="pl-pds">'</span></span>
  data[<span class="pl-c1">:sticky</span>] <span class="pl-k">=</span> <span class="pl-c1">true</span>
  data[<span class="pl-c1">:image</span>] <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>&lt;img class=<span class="pl-cce">\"</span>gritter-image<span class="pl-cce">\"</span> src=<span class="pl-cce">\"</span>/plugin_assets/redmine_pusher_notifications/images/ok.png<span class="pl-cce">\"</span>&gt;<span class="pl-pds">"</span></span>
  gflash <span class="pl-c1">:now</span>, <span class="pl-c1">:success</span> =&gt; { <span class="pl-c1">:value</span> =&gt; data[<span class="pl-c1">:message</span>], <span class="pl-c1">:sticky</span> =&gt; data[<span class="pl-c1">:sticky</span>], <span class="pl-c1">:image</span> =&gt; data[<span class="pl-c1">:image</span>] }
<span class="pl-k">end</span></pre></div>

<p>In a JS partial :</p>

<div class="highlight highlight-ruby"><pre>$(document).ready(function() {
  <span class="pl-k">&lt;</span><span class="pl-k">%=</span> gflash <span class="pl-c1">:js</span> =&gt; <span class="pl-c1">true</span> <span class="pl-s"><span class="pl-pds">%&gt;</span></span>
<span class="pl-s">});</span></pre></div>

<p>In a HTML partial :</p>

<div class="highlight highlight-ruby"><pre><span class="pl-k">&lt;</span><span class="pl-k">%=</span> link_to <span class="pl-s"><span class="pl-pds">'</span>Test me!<span class="pl-pds">'</span></span>, test_path, <span class="pl-c1">:remote</span> =&gt; <span class="pl-c1">true</span> <span class="pl-s"><span class="pl-pds">%&gt;</span></span></pre></div>

<p>For more details, take a look at <a href="https://github.com/RobinBrouwer/gritter#gflash">gritter</a>.</p>

<h2>
<a id="contribute" class="anchor" href="#contribute" aria-hidden="true"><span class="octicon octicon-link"></span></a>Contribute</h2>

<p>You can contribute to this plugin in many ways such as :</p>

<ul>
<li>Helping with documentation</li>
<li>Contributing code (features or bugfixes)</li>
<li>Reporting a bug</li>
<li>Submitting translations</li>
</ul>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/jbox-web/redmine_pusher_notifications">Redmine Pusher Notifications</a> is maintained by <a href="https://github.com/jbox-web">jbox-web</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

            <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-36504891-3");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>
